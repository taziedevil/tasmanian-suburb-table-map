
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>REIT Suburb Report Finder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Open Sans', sans-serif;
      margin: 0;
      background: #f9f9f9;
    }
    .header {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: #ffffff;
      padding: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    .header h2 {
      color: #2E6B52;
      margin: 0 0 10px 0;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }
    input, select {
      width: 100%;
      padding: 10px;
      font-size: 1rem;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    .results {
  
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }
    .card {
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      overflow: hidden;
      animation: fadeInUp 0.6s ease forwards;
    }
    .card-header {
      background-color: #2E6B52;
      color: white;
      padding: 12px;
      font-weight: 600;
    }
    .card-body {
      padding: 15px;
    }
    .card-body a {
      display: flex;
      align-items: center;
      text-decoration: none;
      margin: 6px 0;
      color: #2E6B52;
    }
    .card-body a:hover {
      text-decoration: underline;
    }
    .icon {
      margin-right: 8px;
      font-size: 1.2rem;
    }
    #map {
      height: 600px;
      margin-top: 30px;
      border: 2px solid #ccc;
      border-radius: 10px;
    }
    #suburbCount {
      margin-bottom: 10px;
      font-weight: bold;
      color: #2E6B52;
    }
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  
    .highlight {
      animation: pulseHighlight 1.5s ease;
    }
    @keyframes pulseHighlight {
      0% { background-color: #e0f4eb; }
      100% { background-color: transparent; }
    }
    
    .suburb-label {
      font-size: 0.85rem;
      font-weight: 600;
      background: white;
      border: 1px solid #ccc;
      padding: 2px 6px;
      border-radius: 4px;
      color: #2E6B52;
    }
    </style>
</head>
<body>
  <div class="header">
    <div class="container">
      <h2>Tasmanian Suburb Reports</h2>
      <input type="text" id="suburbSearch" placeholder="Search by suburb..." />
      <select id="municipalitySelect">
        <option value="">-- Select a municipality --</option>
      </select>
    </div>
  </div>

  <div class="container">
    <div id="suburbCount"></div>
    
    <div id="results" class="results" style="max-height: 700px; overflow: hidden;"></div>
    <div style="text-align:center; margin: 20px 0;">
      <button id="toggleMore" style="padding: 10px 20px; font-size: 1rem; background-color: #2E6B52; color: white; border: none; border-radius: 5px; cursor: pointer;">
        Show More ‚ñæ
      </button>
    </div>
    
    <div id="map"></div>
  </div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js">
    document.getElementById('toggleMore').addEventListener('click', () => {
      const results = document.getElementById('results');
      const button = document.getElementById('toggleMore');
      const expanded = results.style.maxHeight === 'none';
      results.style.maxHeight = expanded ? '700px' : 'none';
      button.textContent = expanded ? 'Show More ‚ñæ' : 'Show Less ‚ñ¥';
    });
    </script>
  <script>
    let suburbData = [];

    fetch('suburb_reports_data.json')
      .then(response => response.json())
      .then(data => {
        data.sort((a, b) => a.Suburb.localeCompare(b.Suburb));
        suburbData = data;
        populateMunicipalityList(data);
        setupSearch(data);
        displayResults(data);
        initMap(data);
      });

    function populateMunicipalityList(data) {
      const select = document.getElementById('municipalitySelect');
      const municipalities = [...new Set(data.map(d => d.Municipality))].sort();
      municipalities.forEach(muni => {
        const option = document.createElement('option');
        option.value = muni;
        option.textContent = muni;
        select.appendChild(option);
      });
      select.addEventListener('change', () => {
        const value = select.value;
        const filtered = value ? suburbData.filter(d => d.Municipality === value) : suburbData;
        displayResults(filtered);
        initMap(filtered);
        const bounds = L.latLngBounds(filtered.filter(d => d.Lat && d.Lon).map(d => [d.Lat, d.Lon]));
        if (bounds.isValid()) map.fitBounds(bounds);
      });
    }

    function setupSearch(data) {
      const input = document.getElementById('suburbSearch');
      input.addEventListener('input', () => {
        const q = input.value.toLowerCase();
        const filtered = suburbData.filter(d => d.Suburb.toLowerCase().includes(q));
        displayResults(filtered);
        initMap(filtered);
        const bounds = L.latLngBounds(filtered.filter(d => d.Lat && d.Lon).map(d => [d.Lat, d.Lon]));
        if (bounds.isValid()) map.fitBounds(bounds);
      });
    }

    function displayResults(data) {
      const results = document.getElementById('results');
      const count = document.getElementById('suburbCount');
      results.innerHTML = '';
      count.textContent = `Showing ${data.length} suburb${data.length !== 1 ? 's' : ''}`;

      data.forEach(d => {
        const card = document.createElement('div');
        const id = 'suburb-' + d.Suburb.toLowerCase().replace(/\s+/g, '-');
        card.className = 'card';
        card.id = id;
        card.innerHTML = `
          <div class="card-header" id="suburb-${d.Suburb.toLowerCase().replace(/\s+/g, "-")}">${d.Suburb} (${d.Municipality})</div>
          <div class="card-body">
            ${d.Houses ? `<a href="${d.Houses}" target="_blank"><span class="icon">üè†</span> Houses Report</a>` : ''}
            ${d.Other ? `<a href="${d.Other}" target="_blank"><span class="icon">üè¢</span> Other Dwellings Report</a>` : ''}
            ${d.Land ? `<a href="${d.Land}" target="_blank"><span class="icon">üå±</span> Land Report</a>` : ''}
            ${d.Rental ? `<a href="${d.Rental}" target="_blank"><span class="icon">üîë</span> Rental Report</a>` : ''}
          </div>`;
        results.appendChild(card);
      });
    }

    let map, markers = [];

    function initMap(data) {
      if (!map) {
        map = L.map('map').setView([-42.0409, 146.8087], 7);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);
      }

      markers.forEach(m => map.removeLayer(m));
      markers = [];

      data.forEach(d => {
        if (d.Lat != null && d.Lon != null) { console.log("Marker for", d.Suburb, d.Lat, d.Lon);
          const marker = L.circleMarker([d.Lat, d.Lon], {
            radius: 7,
            color: '#2E6B52',
            fillColor: '#2E6B52',
            fillOpacity: 0.8
          }).addTo(map);
          marker.bindPopup(`<strong>${d.Suburb}</strong><br>${d.Municipality}<br>
            ${d.Houses ? `<a href="${d.Houses}" target="_blank">üè† Houses</a><br>` : ''}
            ${d.Other ? `<a href="${d.Other}" target="_blank">üè¢ Other Dwellings</a><br>` : ''}
            ${d.Land ? `<a href="${d.Land}" target="_blank">üå± Land</a><br>` : ''}
            ${d.Rental ? `<a href="${d.Rental}" target="_blank">üîë Rental</a>` : ''}
          `);
          marker.bindTooltip(d.Suburb, { permanent: true, direction: 'top', offset: [0, -20], className: 'suburb-label' });
      markers.push(marker);
        }
      });
    }
  
    document.getElementById('toggleMore').addEventListener('click', () => {
      const results = document.getElementById('results');
      const button = document.getElementById('toggleMore');
      const expanded = results.style.maxHeight === 'none';
      results.style.maxHeight = expanded ? '700px' : 'none';
      button.textContent = expanded ? 'Show More ‚ñæ' : 'Show Less ‚ñ¥';
    });
    </script>
</body>
</html>
